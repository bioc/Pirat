---
title: "Pirat"
author: "Lucas Etourneau, Samuel Wieczorek"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Pirat}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Table of content

1. [Pirat installation](#dunno)

## Pirat installation

Pirat requires a particular Python environment to work. Follow instructions in the README file to install Pirat correctly.

## Standard imputation with Pirat

Load Pirat package and a reduced part of Bouyssie2020 dataset in the environment.
```{r, eval=F}
library(Pirat)
data("bouyssie")
```

Note that `bouyssie` is actually a list that contains two elements:

1. `peptides_ab`, the matrix of peptide log-2-abundances, with samples in rows and peptides in columns.
2. `adj`, the adjacency matrix between peptides and proteins, containing etiher booleans or 0s and 1s.

You can then impute this dataset with the following line
```{r, eval=F}
imp.res = pipeline_llkimpute(bouyssie)
```

The result `imp.res` is a list that contains:

1. `data.imputed`, the imputed log-2 abundance matrix.
2. `params`, a list containing parameters $\Gamma$ and hyperparameters $\alpha$ and $\beta$.

You can check the imputed values here...
```{r}
head(imp.res$data.imputed[1:5])
```

...and the computed parameters here.
```{r}
imp.res$params
```
Note that a positive value for $\gamma_1$ indicates that a random left-truncation mechanism
is present in the dataset.

## Intra-PG correlation analysis

Pirat has a diagnosis tool that compares distributions of correlations at random and intra-PG.
We use it here on a subset of Ropers2021 dataset, with only 10 PGs and 50 peptides. Note that 
the correlations are computed only on fully observed peptides.
```{r}
data("ropers")
plot_pep_correlations(ropers, titlename = "Ropers sub-set")
```
 We see here that the blue distribution has more weights on high correlations than the red one,
 indicating that making PGs should help for imputation.
 
 ## Pirat extensions
 
 To handle singleton PGs, Pirat proposes three extentions, on top of the classical Pirat approach.
 Note that the -T extensions can be applied to up to an arbitrary PG size. 
 
 ### -2, the 2-peptide rule
 
 The -2 extension simply consists in not imputing singleton PGs. It can be used as following.
```{r}
imp.res = pipeline_llkimpute(ropers, extension = "2")
```
We can then check that singleton peptides are not imputed (yet some may be already fully observed).
```{r}
idx.sing.pg = which(colSums(ropers$adj) == 1)
imp.res$data.imputed[, idx.sing.pg]
```

 
 
 



Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
